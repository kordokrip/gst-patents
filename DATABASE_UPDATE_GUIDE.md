# ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ê°€ì´ë“œ

## ğŸ“Š ê°œìš”

GST íŠ¹í—ˆ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—‘ì…€ íŒŒì¼ê³¼ PDF ì›ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.

## ğŸ¯ ì—…ë°ì´íŠ¸ ì™„ë£Œ ë‚´ì—­

### 1. ë°ì´í„° ì†ŒìŠ¤
- **ì—‘ì…€ íŒŒì¼**: `db/GST ì§€ì‹ì¬ì‚°ê¶Œ ê´€ë¦¬í˜„í™©_20250924.xlsx`
  - ì´ **190ê°œ** íŠ¹í—ˆ ë°ì´í„°
  - ì‹œíŠ¸: "GST ì§€ì‹ì¬ì‚°ê¶Œ í˜„í™©_ìµœì‹ "
  - ì»¬ëŸ¼: NO, ê¶Œë¦¬, ìƒíƒœ, ì¶œì›êµ­, ì¶œì›ì¼, ì¶œì›ë²ˆí˜¸, ë“±ë¡ì¼, ë“±ë¡ë²ˆí˜¸, ëª…ì¹­, ì¡´ì†ì—¬ë¶€ ë“±

- **PDF íŒŒì¼**: `db/pdf/*.pdf`
  - ì´ **75ê°œ** PDF ì›ë¬¸
  - **65ê°œ** ìë™ ë§¤ì¹­ ì„±ê³µ (86.7%)

### 2. ë°ì´í„°ë² ì´ìŠ¤ í†µê³„

```
ì´ íŠ¹í—ˆ ìˆ˜: 190ê°œ

ì¹´í…Œê³ ë¦¬ë³„:
  - scrubber: 107ê°œ (56.3%)
  - other: 38ê°œ (20.0%)
  - chiller: 32ê°œ (16.8%)
  - plasma: 5ê°œ (2.6%)
  - gas-treatment: 4ê°œ (2.1%)
  - temperature: 4ê°œ (2.1%)

ìƒíƒœë³„:
  - ë“±ë¡: 68ê°œ (35.8%)
  - í¬ê¸°: 47ê°œ (24.7%)
  - ì¶œì›: 36ê°œ (18.9%)
  - ê±°ì ˆ: 28ê°œ (14.7%)
  - ì·¨ì†Œ: 8ê°œ (4.2%)
  - unknown: 3ê°œ (1.6%)

PDF ë§¤ì¹­: 65ê°œ (34.2%)
```

## ğŸš€ ì‹¤í–‰ ë‹¨ê³„

### Step 1: ë¡œì»¬ SQLite ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±

```bash
python scripts/update_patent_database.py
```

**ì‘ì—… ë‚´ìš©:**
1. ì—‘ì…€ íŒŒì¼ì—ì„œ 190ê°œ íŠ¹í—ˆ ë°ì´í„° ì¶”ì¶œ
2. PDF íŒŒì¼ê³¼ íŠ¹í—ˆë²ˆí˜¸ ìë™ ë§¤ì¹­ (65ê°œ ì„±ê³µ)
3. ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜ (í‚¤ì›Œë“œ ê¸°ë°˜)
4. SQLite ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± (`db/patents.db`)
5. JSON íŒŒì¼ ìƒì„± (`db/patents_data.json`)

**ìƒì„± íŒŒì¼:**
- `db/patents.db` - SQLite ë°ì´í„°ë² ì´ìŠ¤
- `db/patents_data.json` - JSON í˜•ì‹ ë°ì´í„° (ì›¹ ì•±ìš©)
- `db/patents.db.backup` - ê¸°ì¡´ DB ë°±ì—…

### Step 2: D1 ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
wrangler d1 execute gst_patents_db \
  --file migrations/0004_import_excel_data.sql \
  --remote
```

**ì‘ì—… ë‚´ìš©:**
1. `patents` í…Œì´ë¸”ì— ìƒˆ ì»¬ëŸ¼ ì¶”ê°€:
   - `right_type` - ê¶Œë¦¬ êµ¬ë¶„ (íŠ¹í—ˆ/ì‹¤ìš©ì‹ ì•ˆ)
   - `country` - ì¶œì›êµ­
   - `interim_status` - ì¤‘ê°„ì‚¬í•­/ìµœì¢…ê²°ê³¼
   - `maintenance_status` - ì¡´ì†ì—¬ë¶€
   - ê¸°íƒ€ ê´€ë¦¬ í•„ë“œ

2. í†µê³„ìš© ë·° ìƒì„±:
   - `v_patent_statistics` - ì „ì²´ í†µê³„
   - `v_category_stats` - ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
   - `v_yearly_stats` - ì—°ë„ë³„ í†µê³„

### Step 3: D1 ë°ì´í„° ì—…ë¡œë“œ

```bash
python scripts/simple_d1_upload.py
```

**ì‘ì—… ë‚´ìš©:**
1. `patents_data.json`ì—ì„œ ë°ì´í„° ë¡œë“œ
2. ë°°ì¹˜ ë‹¨ìœ„ (15ê°œì”©) SQL INSERT ë¬¸ ìƒì„±
3. Cloudflare D1ì— ì—…ë¡œë“œ
4. ë°œëª…ì, í‚¤ì›Œë“œ, ê²€ìƒ‰ ì¸ë±ìŠ¤ í•¨ê»˜ ì—…ë¡œë“œ

**ì§„í–‰ ìƒí™©:**
- ì´ 13ê°œ ë°°ì¹˜ (190ê°œ íŠ¹í—ˆ Ã· 15)
- ê° ë°°ì¹˜ë§ˆë‹¤ 1ì´ˆ ëŒ€ê¸° (API ì œí•œ íšŒí”¼)
- ì˜ˆìƒ ì†Œìš” ì‹œê°„: ì•½ 3-5ë¶„

## ğŸ“ íŒŒì¼ êµ¬ì¡°

### ìƒì„±ëœ íŒŒì¼
```
db/
â”œâ”€â”€ patents.db              # ë¡œì»¬ SQLite DB
â”œâ”€â”€ patents.db.backup       # ë°±ì—… íŒŒì¼
â””â”€â”€ patents_data.json       # JSON ë°ì´í„° (ì›¹ìš©)

migrations/
â””â”€â”€ 0004_import_excel_data.sql  # D1 ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜

scripts/
â”œâ”€â”€ update_patent_database.py   # ë¡œì»¬ DB ìƒì„± ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ simple_d1_upload.py         # D1 ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ upload_to_d1.py            # ê³ ê¸‰ ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸ (ë¯¸ì‚¬ìš©)
```

## ğŸ” ë°ì´í„° ê²€ì¦

### ë¡œì»¬ SQLite í™•ì¸

```bash
sqlite3 db/patents.db "SELECT COUNT(*) FROM patents"
sqlite3 db/patents.db "SELECT category, COUNT(*) FROM patents GROUP BY category"
```

### D1 í™•ì¸

```bash
# ì´ íŠ¹í—ˆ ìˆ˜
wrangler d1 execute gst_patents_db \
  --command "SELECT COUNT(*) FROM patents" \
  --remote

# ì¹´í…Œê³ ë¦¬ë³„ í†µê³„
wrangler d1 execute gst_patents_db \
  --command "SELECT * FROM v_category_stats" \
  --remote

# ìƒíƒœë³„ í†µê³„
wrangler d1 execute gst_patents_db \
  --command "SELECT status, COUNT(*) FROM patents GROUP BY status" \
  --remote
```

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™

### API ì—”ë“œí¬ì¸íŠ¸

ê¸°ì¡´ APIëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤:

```
GET /api/patents?page=1&limit=20&category=scrubber
GET /api/patents?id=KR102795314
GET /api/search?q=ìŠ¤í¬ëŸ¬ë²„&page=1&limit=20
GET /api/stats
```

### JavaScript ì—…ë°ì´íŠ¸ í•„ìš” ì‚¬í•­

1. **`js/api-client.js`** - ì´ë¯¸ D1 ì§€ì› ì™„ë£Œ
2. **`js/patents.js`** - ìƒˆ í•„ë“œ í‘œì‹œ ì¶”ê°€:
   - ê¶Œë¦¬ êµ¬ë¶„ (íŠ¹í—ˆ/ì‹¤ìš©ì‹ ì•ˆ)
   - ì¡´ì† ì—¬ë¶€
   - ì ìš© ì œí’ˆêµ°

3. **`js/charts.js`** - ìƒˆ ì°¨íŠ¸ ì¶”ê°€:
   - ê¶Œë¦¬ë³„ í†µê³„ (íŠ¹í—ˆ vs ì‹¤ìš©ì‹ ì•ˆ)
   - ì¡´ì† ì—¬ë¶€ë³„ í†µê³„

## ğŸ“Š ë°ì´í„° í’ˆì§ˆ

### ì™„ì„±ë„
- âœ… íŠ¹í—ˆ ë²ˆí˜¸: 100% (190/190)
- âœ… íŠ¹í—ˆ ëª…ì¹­: 99.5% (189/190)
- âœ… ë“±ë¡ì¼: 95%
- âœ… ì¶œì›ì¼: 98%
- âœ… PDF ì›ë¬¸: 34% (65/190)

### ë§¤ì¹­ ì‹¤íŒ¨ PDF
- 10ê°œì˜ PDFê°€ íŠ¹í—ˆë²ˆí˜¸ ì—†ì´ ëª…ì¹­ìœ¼ë¡œë§Œ ì €ì¥ë¨
- ìˆ˜ë™ ë§¤ì¹­ í•„ìš”:
  - "ëŠ¥ë™í˜• ì—ë„ˆì§€ ì„¸ì´ë¹™ ìŠ¤í¬ëŸ¬ë²„.pdf"
  - "ìŠ¤í¬ëŸ¬ë²„ ê³ ì°© íŒŒìš°ë”ì˜ ìë™ ì„¸ì • ë°©ë²• ë° ìë™ ì„¸ì •ì¥ì¹˜.pdf"
  - "ë³µìˆ˜ì˜ ë²„ë‹ì±”ë²„ë¥¼ êµ¬ë¹„í•œ ìŠ¤í¬ëŸ¬ë²„.pdf"
  - ë“± 10ê°œ

## ğŸ”„ í–¥í›„ ì—…ë°ì´íŠ¸ ë°©ë²•

### ì—‘ì…€ íŒŒì¼ ì—…ë°ì´íŠ¸ ì‹œ

1. ì—‘ì…€ íŒŒì¼ì„ `db/` í´ë”ì— ì €ì¥
2. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:
   ```bash
   python scripts/update_patent_database.py
   python scripts/simple_d1_upload.py
   ```

### PDF íŒŒì¼ ì¶”ê°€ ì‹œ

1. PDFë¥¼ `db/pdf/` í´ë”ì— ì €ì¥
2. íŒŒì¼ëª…ì— íŠ¹í—ˆë²ˆí˜¸ í¬í•¨ (ì˜ˆ: `10-1234567_ì œëª©.pdf`)
3. ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰í•˜ë©´ ìë™ ë§¤ì¹­

## ğŸ› ë¬¸ì œ í•´ê²°

### ì—…ë¡œë“œ íƒ€ì„ì•„ì›ƒ
```python
# simple_d1_upload.pyì—ì„œ ë°°ì¹˜ í¬ê¸° ì¡°ì •
upload_to_d1(batch_size=10)  # ê¸°ë³¸ê°’: 15
```

### PDF ë§¤ì¹­ ì‹¤íŒ¨
```python
# update_patent_database.pyì˜ match_pdf_to_patent í•¨ìˆ˜ í™•ì¸
# PDF íŒŒì¼ëª… í˜•ì‹: {íŠ¹í—ˆë²ˆí˜¸}_{ì œëª©}.pdf ê¶Œì¥
```

### D1 ìš©ëŸ‰ í™•ì¸
```bash
wrangler d1 info gst_patents_db
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ì¸ë±ìŠ¤
ìë™ ìƒì„±ëœ ì¸ë±ìŠ¤:
- `idx_patents_right_type`
- `idx_patents_status`
- `idx_patents_maintenance_status`
- `idx_patents_category`

### FTS5 ê²€ìƒ‰
- `patent_search` í…Œì´ë¸”ì— ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ì¸ë±ìŠ¤ ìƒì„±ë¨
- ì œëª©, ì´ˆë¡, ê¸°ìˆ ë¶„ë¥˜, ì›ë¬¸ í…ìŠ¤íŠ¸ ê²€ìƒ‰ ê°€ëŠ¥

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì—‘ì…€ ë°ì´í„° íŒŒì‹± (190ê°œ)
- [x] PDF ìë™ ë§¤ì¹­ (65ê°œ)
- [x] SQLite DB ìƒì„±
- [x] JSON íŒŒì¼ ìƒì„±
- [x] D1 ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜
- [ ] D1 ë°ì´í„° ì—…ë¡œë“œ (ì§„í–‰ ì¤‘)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì—…ë°ì´íŠ¸
- [ ] ë°°í¬ ë° í…ŒìŠ¤íŠ¸

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ:
1. ë¡œê·¸ í™•ì¸: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì¶œë ¥
2. D1 ìƒíƒœ í™•ì¸: `wrangler d1 info gst_patents_db`
3. ë°±ì—… ë³µì›: `db/patents.db.backup` ì‚¬ìš©
